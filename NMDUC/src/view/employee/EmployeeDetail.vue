<template>
  <div id="dlgPopup" class="m-dialog" :class="{ isShow: isShow }">
    <div class="m-popup-employee">
      <div class="m-popup-employee-header">
        <div class="m-left">
          Th√¥ng tin nh√¢n vi√™n
          <div class="m-header-checkbox">
            <div class="m-checkbox">
              <div class="m-icon-check"></div>
            </div>
            <div class="m-checkbox-text">L√† kh√°ch h√†ng</div>
          </div>
          <div class="m-header-checkbox">
            <div class="m-checkbox">
              <div class="m-icon-check"></div>
            </div>
            <div class="m-checkbox-text">L√† kh√°ch h√†ng</div>
          </div>
        </div>

        <div id="btnCloseDialog" class="m-right">
          <div class="m-icon-question"></div>
          <div class="m-icon-close"></div>
        </div>
      </div>
      <div class="m-popup-employee-content">
        <div class="m-right">
          <div class="m-row-fill">
            <div class="m-fill-in">
              <label for="" class="m-label"> M√£ <span>*</span></label>
              <div class="m-row">
                <input
                  id="txtEmployeeCode"
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  v-model="employee.EmployeeCode"
                />
                <div class="m-wrap-popup-error">
                  <div class="m-popup-error">
                    Th√¥ng tin n√†y kh√¥ng ƒë∆∞·ª£c b·ªè tr·ªëng !
                  </div>
                </div>
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label">T√™n <span>*</span> </label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtFullName"
                  v-model="employee.FullName"
                />
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label"> Ng√†y sinh </label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="date"
                  name=""
                  id="dtDate"
                  v-bind:value="
                    employee.DateOfBirth
                     
                  "
                />
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label"> Gi·ªõi t√≠nh </label>
              <div class="m-row-radio">
                <div class="m-check">
                  <div class="checkmark"><div class="dot dot-1"></div></div>
                  <div class="container">Nam</div>
                </div>

                <div class="m-check">
                  <div class="checkmark"><div class="dot dot-0"></div></div>
                  <label class="container">N·ªØ</label>
                </div>
                <div class="m-check">
                  <div class="checkmark"><div class="dot dot-2"></div></div>
                  <label class="container">Kh√°c</label>
                </div>
              </div>
            </div>
            <div class="m-fill-in row-2">
              <label for="" class="m-label"> ƒê∆°n v·ªã <span>*</span> </label>
              <div class="m-row">
                <!-- <combobox
                  id="cbxDepartment"
                  api="http://amis.manhnv.net/api/v1/Departments"
                  propertyDisplay="DepartmentName"
                  propertyValue="DepartmentId"
                >
                </combobox> -->
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label"> S·ªë CMND </label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id=""
                />
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label"> Ng√†y c·∫•p </label>
              <div class="m-row">
                <div class="m-row">
                  <input
                    class="m-input"
                    placeholder=""
                    type="date"
                    name=""
                    id="dtDateIdentity"
                  />
                </div>
              </div>
            </div>
            <div class="m-fill-in row-2">
              <label for="" class="m-label"> Ch·ª©c danh </label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                />
                <!-- <combobox
                  id="cbxPosition"
                  api="http://amis.manhnv.net/api/v1/Positions"
                  propertyDisplay="PositionName"
                  propertyValue="PositionId"
                >
                </combobox> -->
              </div>
            </div>
            <div class="m-fill-in row-2">
              <label for="" class="m-label"> N∆°i c·∫•p </label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtAddress"
                />
              </div>
            </div>
          </div>
          <br />
          <div class="m-row-fill">
            <div class="m-fill-in row-full">
              <label for="" class="m-label"> ƒê·ªãa ch·ªâ </label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtEmail"
                />
              </div>
            </div>
          </div>

          <div class="m-row-fill">
            <div class="m-fill-in">
              <label for="" class="m-label">ƒêT di ƒë·ªông </label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtEmail"
                  v-model="employee.PhoneNumber"
                />
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label">ƒêT c·ªë ƒë·ªãnh </label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtEmail"
                />
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label">Email</label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtEmail"
                />
              </div>
            </div>
          </div>
          <div class="m-row-fill">
            <div class="m-fill-in">
              <label for="" class="m-label">T√†i kho·∫£n ng√¢n h√†ng</label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtEmail"
                />
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label">T√™n ng√¢n h√†ng</label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtEmail"
                />
              </div>
            </div>
            <div class="m-fill-in">
              <label for="" class="m-label">Chi nh√°nh</label>
              <div class="m-row">
                <input
                  class="m-input"
                  placeholder=""
                  type="text"
                  name=""
                  id="txtEmail"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="m-row-rim">
        <div class="m-rim"></div>
      </div>
      <div class="m-popup-employee-footer">
        <div class="left-footer">
          <button
            id="btnCloseDialog"
            @click="btnCancelOnclick()"
            class="m-btn m-continue"
          >
            H·ªßy
          </button>
        </div>
        <div class="right-footer">
          <button id="btnSave" class="m-btn m-continue">C·∫•t</button>
          <button
            id="btnSave-Add"
            class="m-btn m-close"
            @click="btnSaveOnclick()"
          >
            C·∫•t v√† Th√™m
          </button>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
import axios from "axios";
export default {
  name: "EmployeeDetail",
  methods: {
    //x·ª≠ l√≠ cancel
    btnCancelOnclick: function () {
      this.$emit("resetOldId");
      this.$emit("resetNewCode");
      this.employee = {};
      this.$emit("showDialog", false);
      this.$emit("loadData");
    },
    //x·ª≠ l√≠ khi 'c·∫•t v√† th√™m'
    btnSaveOnclick: function () {
      var me = this;
      if (this.employeeId == null) {
        //th√™m m·ªõi
        //g·ªçi api
        axios({
          method: "post",
          url: "http://cukcuk.manhnv.net/api/v1/Employees",
          data: this.employee,
        })
          .then(function () {
            //loat l·∫°i b·∫£ng
            me.$parent.loadData(); 
            //ƒë√≥ng popup khi th√™m m·ªõi th√†nh c√¥ng
            me.btnCancelOnclick();
          })
          .catch(function (error) {
            //x·ª≠ l√≠ khi th√™m m·ªõi kh√¥ng th√†nh c√¥ng
            console.log(error);
          });
      } else {
        //s·ª≠a
        //g·ªçi api
        axios
          .put(
            `http://cukcuk.manhnv.net/api/v1/Employees/${this.EmployeeId}`,
            this.employee
          )
          .then(function () {
            //s·ª≠a th√†nh c√¥ng
            //ƒë√≥ng popup
            me.$emit("showDialog", false);
          })
          .catch(() => {
            //s·ª≠a kh√¥ng th√†nh c√¥ng
            alert("s·ª≠a kh√¥ng th√†nh c√¥ng");
            
          });
      }
    },
  },

  filters: {
    //x·ª≠ l√≠ khi nh·∫≠p ng√†y sinh
    // fomatDataDDMMYYYY(date) {
    //   console.log(date);
    //   return "20-09-2001";
    // },
  },
  watch: {
    EmployeeCode: function (value) {
      this.employeeId = { EmployeeCode: value };
    },
    //x·ª≠ l√≠ khi c√≥ id m·ªõi ƒëc truy·ªÅn v√†o
    employeeId: function (value) {
      var me = this;
      if (value != null) {
        // show popup detail khi s·ª≠a
        // g·ªçi api l·∫•y d·ªØ li·ªáu
        axios
          .get(`http://cukcuk.manhnv.net/api/v1/Employees/${value}`)
          .then(function (res) {
            //l·∫•y ƒë∆∞·ª£c data
            me.employee = res.data;
            console.log(me.employeee)
          })
          .catch(function (err) {
            //kh√¥ng l·∫•y ƒë∆∞·ª£c data
            console.log("üöÄ ~ file: employeeDetail.vue ~ line 301 ~ err", err);
          });
      }
    },
  },
  props: {
    employeeId: {
      default: null,
      type: String,
    },
    isShow: {
      default: null,
      type: Boolean,
    },
    EmployeeCode: {
      default: null,
      type: String,
    },
  },

  data() {
    return {
      employee: {},
    };
  },
};
</script>